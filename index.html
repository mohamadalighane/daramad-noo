<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="metaTitle">Ø¯Ø±Ø¢Ù…Ø¯ Ù†Ùˆ | Ù…Ù‚Ø§Ù„Ø§Øª Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯</title>
  <meta name="description" id="metaDesc" content="Ù…Ù‚Ø§Ù„Ø§Øª ØªØ®ØµØµÛŒ Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†ØŒ ÙØ±ÛŒÙ„Ù†Ø³Ø±ÛŒØŒ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ùˆ Ú©Ø§Ø±Ø¢ÙØ±ÛŒÙ†ÛŒ">
  <meta name="robots" content="index, follow">
  <link rel="canonical" id="metaCanonical" href="https://mohamadalighane.github.io/daramad-noo/">
  <meta property="og:title" id="ogTitle" content="Ø¯Ø±Ø¢Ù…Ø¯ Ù†Ùˆ">
  <meta property="og:description" id="ogDesc" content="Ù…Ù‚Ø§Ù„Ø§Øª ØªØ®ØµØµÛŒ Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†">
  <meta property="og:image" id="ogImage" content="">
  <meta property="og:type" id="ogType" content="website">
  <script type="application/ld+json" id="schemaOrg">{"@context":"https://schema.org","@type":"WebSite","name":"Ø¯Ø±Ø¢Ù…Ø¯ Ù†Ùˆ","url":"https://mohamadalighane.github.io/daramad-noo/","inLanguage":"fa"}</script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>window.NAJVA={};var s=document.createElement("script");s.src="https://van.najva.com/static/js/main-script.js";s.defer=!0;s.id="najva-mini-script";s.setAttribute("data-najva-id","e35f8d3d-3bb6-4151-bca2-a7b75a5c3f3b");document.head.appendChild(s);</script>

  <script>window.NAJVA={};var s=document.createElement("script");s.src="https://van.najva.com/static/js/main-script.js";s.defer=!0;s.id="najva-mini-script";s.setAttribute("data-najva-id","e35f8d3d-3bb6-4151-bca2-a7b75a5c3f3b");document.head.appendChild(s);</script>

   <script>
            !function(e,t,n){e.yektanetAnalyticsObject=n,e[n]=e[n]||function(){e[n].q.push(arguments)},e[n].q=e[n].q||[];var a=t.getElementsByTagName("head")[0],r=new Date,c="https://cdn.yektanet.com/superscript/YjPyWkx4/native-proai-eta.vercel.app-45688/yn_pub.js?v="+r.getFullYear().toString()+"0"+r.getMonth()+"0"+r.getDate()+"0"+r.getHours(),s=t.createElement("link");s.rel="preload",s.as="script",s.href=c,a.appendChild(s);var l=t.createElement("script");l.async=!0,l.src=c,a.appendChild(l)}(window,document,"yektanet");
        </script>


  <style>
    :root {
      --bg:#ffffff;
      --bg2:#f8f9fa;
      --surface:#ffffff;
      --surface2:#f3f4f6;
      --border:#e5e7eb;
      --accent:#16a34a;
      --accent2:#15803d;
      --accent-light:#dcfce7;
      --accent-dark:#14532d;
      --text:#111827;
      --text2:#374151;
      --text3:#9ca3af;
      --gold:#d97706;
      --red:#dc2626;
      --blue:#2563eb;
      --shadow-sm:0 1px 3px rgba(0,0,0,.08);
      --shadow:0 4px 20px rgba(0,0,0,.08);
      --shadow-lg:0 12px 48px rgba(0,0,0,.12);
      --r:16px;
      --r-sm:10px;
      --r-xs:6px;
      --site-title: 'Ø¯Ø±Ø¢Ù…Ø¯ Ù†Ùˆ';
      --site-desc: 'Ù…Ù‚Ø§Ù„Ø§Øª Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†';
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{font-family:'Vazirmatn',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;font-size:15px;line-height:1.7;-webkit-font-smoothing:antialiased}

    /* â”€â”€ SCROLLBAR â”€â”€ */
    ::-webkit-scrollbar{width:6px}
    ::-webkit-scrollbar-track{background:var(--bg2)}
    ::-webkit-scrollbar-thumb{background:var(--accent);border-radius:3px}

    /* â”€â”€ HEADER â”€â”€ */
    header{background:rgba(255,255,255,.92);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:200;transition:box-shadow .3s}
    header.scrolled{box-shadow:var(--shadow)}
    .hdr{max-width:1280px;margin:0 auto;padding:0 24px;height:68px;display:flex;align-items:center;justify-content:space-between;gap:16px}
    .logo{display:flex;align-items:center;gap:12px;cursor:pointer;text-decoration:none}
    .logo-mark{width:42px;height:42px;background:linear-gradient(135deg,var(--accent),var(--accent-dark));border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 4px 12px rgba(22,163,74,.3);flex-shrink:0;transition:transform .2s}
    .logo:hover .logo-mark{transform:rotate(-8deg) scale(1.05)}
    .logo-text{display:flex;flex-direction:column;gap:1px}
    .logo-name{font-weight:900;font-size:17px;color:var(--text);line-height:1;letter-spacing:-.3px}
    .logo-sub{font-size:11px;color:var(--text3);line-height:1}
    .hdr-nav{display:flex;align-items:center;gap:8px}
    .nav-link{padding:8px 16px;border-radius:var(--r-xs);font-size:13px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .2s;border:none;background:none;font-family:'Vazirmatn',sans-serif}
    .nav-link:hover{background:var(--surface2);color:var(--text)}
    .nav-link.primary{background:var(--accent);color:#fff;box-shadow:0 2px 8px rgba(22,163,74,.25)}
    .nav-link.primary:hover{background:var(--accent2);box-shadow:0 4px 14px rgba(22,163,74,.35);transform:translateY(-1px)}

    /* â”€â”€ PAGES â”€â”€ */
    .page{display:none}
    .page.active{display:block;animation:fadeUp .35s cubic-bezier(.16,1,.3,1)}
    @keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}

    /* â”€â”€ HERO SLIDER â”€â”€ */
    .slider-section{position:relative;overflow:hidden;background:#111;min-height:500px}
    .slides{display:flex;transition:transform .6s cubic-bezier(.65,0,.35,1);height:100%}
    .slide{min-width:100%;position:relative;min-height:500px;display:flex;align-items:center;overflow:hidden}
    .slide-bg{position:absolute;inset:0;background-size:cover;background-position:center;transition:transform 6s ease}
    .slide-bg::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(0,0,0,.72) 0%,rgba(0,0,0,.3) 100%)}
    .slide.active .slide-bg{transform:scale(1.05)}
    .slide-content{position:relative;z-index:2;max-width:700px;padding:60px 60px;color:#fff}
    .slide-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(255,255,255,.15);backdrop-filter:blur(10px);padding:6px 14px;border-radius:50px;font-size:12px;font-weight:700;margin-bottom:20px;border:1px solid rgba(255,255,255,.2)}
    .slide-title{font-size:clamp(26px,4vw,44px);font-weight:900;line-height:1.25;margin-bottom:16px;letter-spacing:-.5px}
    .slide-desc{font-size:15px;opacity:.85;max-width:480px;margin-bottom:28px;line-height:1.7}
    .slide-btn{display:inline-flex;align-items:center;gap:8px;background:var(--accent);color:#fff;padding:13px 28px;border-radius:50px;font-family:'Vazirmatn',sans-serif;font-size:14px;font-weight:700;cursor:pointer;border:none;transition:all .25s;box-shadow:0 4px 20px rgba(22,163,74,.4)}
    .slide-btn:hover{background:var(--accent2);transform:translateY(-2px);box-shadow:0 8px 28px rgba(22,163,74,.5)}
    .slider-controls{position:absolute;bottom:24px;left:50%;transform:translateX(-50%);display:flex;gap:8px;z-index:10}
    .dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.4);cursor:pointer;transition:all .3s;border:none}
    .dot.active{width:24px;border-radius:4px;background:#fff}
    .slider-arrows{position:absolute;top:50%;transform:translateY(-50%);width:100%;display:flex;justify-content:space-between;padding:0 20px;z-index:10;pointer-events:none}
    .slider-arrow{width:44px;height:44px;border-radius:50%;background:rgba(255,255,255,.15);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.25);color:#fff;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;pointer-events:all}
    .slider-arrow:hover{background:rgba(255,255,255,.28)}

    /* â”€â”€ MAIN â”€â”€ */
    .main{max-width:1280px;margin:0 auto;padding:52px 24px}
    .section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:28px}
    .section-title{font-size:22px;font-weight:800;color:var(--text);position:relative;padding-right:16px}
    .section-title::before{content:'';position:absolute;right:0;top:50%;transform:translateY(-50%);width:4px;height:22px;background:linear-gradient(to bottom,var(--accent),var(--accent2));border-radius:2px}
    .art-count{font-size:13px;color:var(--text3);background:var(--surface2);padding:4px 12px;border-radius:50px}

    /* â”€â”€ CAT FILTER â”€â”€ */
    .cat-filter{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:32px}
    .cat-chip{padding:7px 18px;border-radius:50px;border:1.5px solid var(--border);background:var(--surface);font-family:'Vazirmatn',sans-serif;font-size:13px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .2s}
    .cat-chip:hover{border-color:var(--accent);color:var(--accent)}
    .cat-chip.active{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 2px 10px rgba(22,163,74,.25)}

    /* â”€â”€ GRID â”€â”€ */
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:28px}
    .card{background:var(--surface);border-radius:var(--r);border:1px solid var(--border);overflow:hidden;box-shadow:var(--shadow-sm);transition:all .3s cubic-bezier(.16,1,.3,1);cursor:pointer;display:flex;flex-direction:column}
    .card:hover{transform:translateY(-6px);box-shadow:var(--shadow-lg);border-color:transparent}
    .card-img-wrap{position:relative;overflow:hidden;height:210px;background:linear-gradient(135deg,var(--accent-light),#f0fdf4)}
    .card-img{width:100%;height:100%;object-fit:cover;transition:transform .5s ease}
    .card:hover .card-img{transform:scale(1.06)}
    .card-ph{height:100%;display:flex;align-items:center;justify-content:center;font-size:52px}
    .card-cat-badge{position:absolute;top:14px;right:14px;background:rgba(255,255,255,.92);backdrop-filter:blur(8px);padding:4px 12px;border-radius:50px;font-size:11px;font-weight:700;color:var(--accent)}
    .card-body{padding:22px;flex:1;display:flex;flex-direction:column}
    .card-date{font-size:11px;color:var(--text3);margin-bottom:10px;display:flex;align-items:center;gap:4px}
    .card-title{font-size:17px;font-weight:800;margin-bottom:10px;line-height:1.45;color:var(--text);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .card-desc{color:var(--text2);font-size:13px;line-height:1.7;flex:1;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;margin-bottom:16px}
    .card-foot{display:flex;justify-content:space-between;align-items:center;padding-top:14px;border-top:1px solid var(--border)}
    .read-more{color:var(--accent);font-weight:700;font-size:13px;display:flex;align-items:center;gap:4px}
    .read-more::after{content:'â†';transition:transform .2s}
    .card:hover .read-more::after{transform:translateX(-4px)}

    /* â”€â”€ SEARCH â”€â”€ */
    .search-bar{max-width:560px;margin:0 auto 32px;position:relative}
    .search-input{width:100%;padding:14px 48px 14px 20px;border-radius:50px;border:2px solid var(--border);font-family:'Vazirmatn',sans-serif;font-size:14px;color:var(--text);background:var(--surface);outline:none;transition:border-color .2s;box-shadow:var(--shadow-sm)}
    .search-input:focus{border-color:var(--accent);box-shadow:0 0 0 4px rgba(22,163,74,.08)}
    .search-icon{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:var(--text3);font-size:18px}

    /* â”€â”€ PAGINATION â”€â”€ */
    .pagination{display:flex;justify-content:center;align-items:center;gap:6px;margin-top:48px;flex-wrap:wrap}
    .pg-btn{min-width:40px;height:40px;padding:0 6px;border-radius:var(--r-xs);border:1.5px solid var(--border);background:var(--surface);color:var(--text2);font-family:'Vazirmatn',sans-serif;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;justify-content:center}
    .pg-btn:hover:not(:disabled){background:var(--surface2)}
    .pg-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
    .pg-btn:disabled{opacity:.35;cursor:not-allowed}
    .pg-sep{color:var(--text3);font-size:13px;padding:0 4px}

    /* â”€â”€ EMPTY â”€â”€ */
    .empty{text-align:center;padding:80px 20px;grid-column:1/-1}
    .empty-icon{font-size:60px;margin-bottom:16px}
    .empty h3{font-size:19px;font-weight:800;color:var(--text2);margin-bottom:8px}
    .empty p{color:var(--text3);font-size:14px}

    /* â”€â”€ DETAIL â”€â”€ */
    .detail-outer{background:var(--bg)}
    .detail-wrap{max-width:820px;margin:0 auto;padding:48px 24px}
    .back-btn{display:inline-flex;align-items:center;gap:8px;color:var(--text2);font-size:14px;font-weight:600;cursor:pointer;margin-bottom:36px;padding:9px 18px;background:var(--surface);border:1.5px solid var(--border);border-radius:50px;transition:all .2s}
    .back-btn:hover{background:var(--surface2);border-color:var(--accent);color:var(--accent)}
    .detail-img{width:100%;max-height:460px;object-fit:cover;border-radius:var(--r);margin-bottom:36px;box-shadow:var(--shadow)}
    .detail-title{font-size:clamp(24px,4vw,36px);font-weight:900;margin-bottom:16px;line-height:1.3;letter-spacing:-.4px}
    .detail-meta{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:24px}
    .detail-meta-item{display:flex;align-items:center;gap:5px;font-size:13px;color:var(--text3)}
    .detail-badge{background:var(--accent-light);color:var(--accent);padding:4px 12px;border-radius:50px;font-size:12px;font-weight:700}
    .detail-actions{display:flex;gap:10px;margin-bottom:32px;flex-wrap:wrap;padding-bottom:28px;border-bottom:2px solid var(--border)}
    .video-frame{border-radius:var(--r);overflow:hidden;margin-bottom:32px;box-shadow:var(--shadow)}
    .video-frame iframe{width:100%;height:380px;border:none;display:block}
    .video-link-btn{display:flex;align-items:center;gap:12px;padding:16px 22px;background:#111;color:#fff;text-decoration:none;border-radius:var(--r);margin-bottom:32px;font-size:14px;font-weight:600}

    /* â”€â”€ RICH CONTENT â”€â”€ */
    .rich-content{color:var(--text2);line-height:1.9;font-size:16px}
    .rich-content h1{font-size:28px;font-weight:900;color:var(--text);margin:36px 0 14px;letter-spacing:-.3px}
    .rich-content h2{font-size:22px;font-weight:800;color:var(--text);margin:30px 0 12px;padding-right:14px;border-right:4px solid var(--accent)}
    .rich-content h3{font-size:18px;font-weight:700;color:var(--text);margin:24px 0 10px}
    .rich-content p{margin-bottom:16px}
    .rich-content strong{font-weight:700;color:var(--text)}
    .rich-content em{font-style:italic}
    .rich-content u{text-decoration:underline}
    .rich-content ul,.rich-content ol{padding-right:28px;margin-bottom:16px}
    .rich-content li{margin-bottom:8px}
    .rich-content a{color:var(--accent);text-decoration:underline}
    .rich-content blockquote{border-right:4px solid var(--gold);padding:16px 20px;margin:24px 0;background:linear-gradient(135deg,#fffbeb,#fef3c7);border-radius:0 var(--r-sm) var(--r-sm) 0;font-style:italic;color:var(--text2)}
    .rich-content .code-block{position:relative;margin:20px 0}
    .rich-content pre{background:#0f172a;color:#e2e8f0;padding:24px;border-radius:var(--r-sm);overflow-x:auto;font-family:'Courier New',monospace;font-size:13px;line-height:1.65;direction:ltr;text-align:left}
    .rich-content .copy-btn{position:absolute;top:10px;left:10px;background:rgba(255,255,255,.1);color:#94a3b8;border:1px solid rgba(255,255,255,.15);border-radius:var(--r-xs);padding:5px 12px;font-size:11px;cursor:pointer;font-family:'Vazirmatn',sans-serif;transition:all .2s}
    .rich-content .copy-btn:hover{background:rgba(255,255,255,.18);color:#e2e8f0}
    .rich-content code{background:#f1f5f9;color:var(--accent);padding:2px 7px;border-radius:4px;font-family:'Courier New',monospace;font-size:13px}
    .rich-content hr{border:none;border-top:2px solid var(--border);margin:28px 0}

    /* â”€â”€ BUTTONS â”€â”€ */
    .btn{display:inline-flex;align-items:center;gap:7px;padding:10px 20px;border-radius:var(--r-xs);font-family:'Vazirmatn',sans-serif;font-size:13px;font-weight:700;cursor:pointer;border:none;transition:all .2s;text-decoration:none}
    .btn-primary{background:var(--accent);color:#fff;box-shadow:0 2px 8px rgba(22,163,74,.2)}
    .btn-primary:hover{background:var(--accent2);transform:translateY(-1px);box-shadow:0 4px 16px rgba(22,163,74,.3)}
    .btn-ghost{background:transparent;color:var(--text2);border:1.5px solid var(--border)}
    .btn-ghost:hover{background:var(--surface2)}
    .btn-danger{background:var(--red);color:#fff}
    .btn-danger:hover{opacity:.88}
    .btn-warn{background:var(--gold);color:#fff}
    .btn-warn:hover{opacity:.88}
    .btn-dark{background:#111;color:#fff}
    .btn-dark:hover{background:#222}
    .btn:disabled{opacity:.45;cursor:not-allowed;transform:none!important}

    /* â”€â”€ LOGIN â”€â”€ */
    .login-page{min-height:80vh;display:flex;align-items:center;justify-content:center;padding:24px;background:radial-gradient(ellipse at 60% 20%,rgba(22,163,74,.06),transparent 60%)}
    .login-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:48px 40px;width:100%;max-width:400px;box-shadow:var(--shadow-lg)}
    .login-icon{text-align:center;font-size:52px;margin-bottom:24px}
    .login-title{font-size:24px;font-weight:900;text-align:center;margin-bottom:6px}
    .login-sub{color:var(--text3);font-size:13px;text-align:center;margin-bottom:32px}

    /* â”€â”€ FORM â”€â”€ */
    .f-group{margin-bottom:18px}
    .f-label{display:block;font-size:13px;font-weight:700;margin-bottom:7px;color:var(--text2)}
    .f-input,.f-textarea,.f-select{width:100%;padding:12px 16px;border:2px solid var(--border);border-radius:var(--r-xs);font-family:'Vazirmatn',sans-serif;font-size:14px;color:var(--text);background:var(--surface);outline:none;transition:border-color .2s}
    .f-input:focus,.f-textarea:focus,.f-select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(22,163,74,.07)}
    .f-textarea{min-height:160px;resize:vertical}
    .f-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .f-full{grid-column:1/-1}
    .alert{padding:12px 16px;border-radius:var(--r-xs);font-size:13px;margin-bottom:16px;display:none;line-height:1.6}
    .alert-err{background:#fef2f2;border:1.5px solid #fecaca;color:var(--red)}
    .alert-ok{background:#f0fdf4;border:1.5px solid #86efac;color:#15803d}

    /* â”€â”€ UPLOAD â”€â”€ */
    .upload-area{border:2px dashed var(--border);border-radius:var(--r-sm);padding:28px;text-align:center;cursor:pointer;transition:all .2s;background:var(--surface2);position:relative;overflow:hidden}
    .upload-area:hover{border-color:var(--accent);background:var(--accent-light)}
    .upload-area input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
    .upload-preview{width:100%;max-height:180px;object-fit:cover;border-radius:var(--r-xs);margin-top:12px;display:none}
    .upload-bar-wrap{height:4px;background:var(--border);border-radius:2px;margin-top:10px;display:none}
    .upload-bar{height:100%;background:var(--accent);border-radius:2px;transition:width .3s;width:0%}

    /* â”€â”€ CAT MANAGER â”€â”€ */
    .cat-manager{background:var(--surface2);border-radius:var(--r-xs);padding:14px;margin-top:8px}
    .cat-manager-title{font-size:11px;font-weight:700;color:var(--text3);margin-bottom:10px;letter-spacing:.5px;text-transform:uppercase}
    .cat-tags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px}
    .cat-tag{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:20px;background:var(--accent-light);color:var(--accent);font-size:12px;font-weight:700}
    .cat-tag .del-cat{cursor:pointer;font-size:15px;line-height:1;color:var(--red);font-weight:800;margin-right:2px}
    .cat-add-row{display:flex;gap:8px}
    .cat-add-input{flex:1;padding:8px 12px;border:2px solid var(--border);border-radius:var(--r-xs);font-family:'Vazirmatn',sans-serif;font-size:13px;outline:none;background:var(--surface);transition:border-color .2s}
    .cat-add-input:focus{border-color:var(--accent)}
    .cat-add-btn{padding:8px 16px;background:var(--accent);color:#fff;border:none;border-radius:var(--r-xs);font-family:'Vazirmatn',sans-serif;font-size:13px;font-weight:700;cursor:pointer}
    .cat-add-btn:hover{background:var(--accent2)}

    /* â”€â”€ EDITOR â”€â”€ */
    .editor-wrap{border:2px solid var(--border);border-radius:var(--r-sm);overflow:hidden;background:var(--surface);transition:border-color .2s}
    .editor-wrap:focus-within{border-color:var(--accent)}
    .editor-toolbar{display:flex;gap:2px;padding:8px 10px;background:var(--surface2);border-bottom:1px solid var(--border);flex-wrap:wrap;align-items:center}
    .tb-btn{min-width:32px;height:32px;border:none;border-radius:var(--r-xs);background:transparent;cursor:pointer;font-size:13px;display:inline-flex;align-items:center;justify-content:center;color:var(--text2);transition:all .2s;font-family:serif;padding:0 6px}
    .tb-btn:hover{background:var(--border)}
    .tb-btn.active{background:var(--accent);color:#fff}
    .tb-sep{width:1px;background:var(--border);margin:0 4px;align-self:stretch;height:24px}
    .tb-select{padding:4px 8px;border:1.5px solid var(--border);border-radius:var(--r-xs);font-family:'Vazirmatn',sans-serif;font-size:12px;background:var(--surface);color:var(--text);cursor:pointer;outline:none}
    .editor-body{min-height:260px;padding:18px;outline:none;font-family:'Vazirmatn',sans-serif;font-size:14px;line-height:1.85;color:var(--text);direction:rtl}
    .editor-body:empty::before{content:attr(data-placeholder);color:var(--text3)}
    .editor-body h1{font-size:22px;font-weight:900;margin:16px 0 8px}
    .editor-body h2{font-size:18px;font-weight:800;margin:14px 0 6px;padding-right:10px;border-right:3px solid var(--accent)}
    .editor-body h3{font-size:15px;font-weight:700;margin:12px 0 4px}
    .editor-body blockquote{border-right:4px solid var(--gold);padding:10px 14px;background:#fffbeb;margin:12px 0;border-radius:0 var(--r-xs) var(--r-xs) 0}
    .editor-body pre{background:#0f172a;color:#e2e8f0;padding:16px;border-radius:var(--r-xs);font-family:monospace;font-size:13px;direction:ltr;text-align:left;margin:12px 0;overflow-x:auto}
    .editor-body code{background:#f1f5f9;color:var(--accent);padding:1px 5px;border-radius:3px;font-family:monospace}
    .editor-body ul,.editor-body ol{padding-right:24px;margin:8px 0}
    .editor-body a{color:var(--accent);text-decoration:underline}
    .editor-footer{padding:7px 14px;background:var(--surface2);border-top:1px solid var(--border);font-size:11px;color:var(--text3);display:flex;justify-content:space-between;align-items:center}

    /* â”€â”€ ADMIN â”€â”€ */
    .admin-layout{display:grid;grid-template-columns:240px 1fr;min-height:calc(100vh - 68px)}
    .admin-sidebar{background:var(--text);padding:28px 0;display:flex;flex-direction:column}
    .sidebar-logo{padding:0 20px 24px;border-bottom:1px solid rgba(255,255,255,.1)}
    .sidebar-logo-text{font-size:15px;font-weight:800;color:#fff}
    .sidebar-logo-sub{font-size:11px;color:rgba(255,255,255,.4);margin-top:2px}
    .sidebar-nav{padding:16px 12px;flex:1}
    .sidebar-section{font-size:10px;font-weight:700;color:rgba(255,255,255,.3);letter-spacing:1px;padding:0 8px;margin:16px 0 6px;text-transform:uppercase}
    .sidebar-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:var(--r-xs);color:rgba(255,255,255,.65);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;border:none;background:none;font-family:'Vazirmatn',sans-serif;width:100%;text-align:right}
    .sidebar-item:hover{background:rgba(255,255,255,.08);color:#fff}
    .sidebar-item.active{background:var(--accent);color:#fff;box-shadow:0 2px 10px rgba(22,163,74,.4)}
    .sidebar-item .icon{font-size:16px;flex-shrink:0}
    .sidebar-footer{padding:16px 12px;border-top:1px solid rgba(255,255,255,.1)}
    .admin-main{background:var(--bg2);overflow-y:auto}
    .admin-topbar{background:var(--surface);border-bottom:1px solid var(--border);padding:0 28px;height:60px;display:flex;align-items:center;justify-content:space-between}
    .admin-topbar-title{font-size:17px;font-weight:800}
    .admin-content{padding:28px}

    /* â”€â”€ PANELS â”€â”€ */
    .panel{background:var(--surface);border-radius:var(--r);border:1px solid var(--border);padding:28px;margin-bottom:24px;box-shadow:var(--shadow-sm)}
    .panel-title{font-size:16px;font-weight:800;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px}
    .stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px}
    .stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-sm);padding:20px;box-shadow:var(--shadow-sm)}
    .stat-num{font-size:32px;font-weight:900;color:var(--accent);line-height:1}
    .stat-label{font-size:12px;color:var(--text3);margin-top:4px;font-weight:600}

    /* â”€â”€ SLIDER ADMIN â”€â”€ */
    .slide-admin-card{background:var(--surface2);border:1.5px solid var(--border);border-radius:var(--r-sm);padding:18px;margin-bottom:12px;display:flex;gap:16px;align-items:center}
    .slide-admin-thumb{width:80px;height:56px;border-radius:var(--r-xs);overflow:hidden;background:var(--border);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:22px}
    .slide-admin-thumb img{width:100%;height:100%;object-fit:cover}
    .slide-admin-info{flex:1;min-width:0}
    .slide-admin-title{font-weight:700;font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-bottom:4px}
    .slide-admin-actions{display:flex;gap:6px;flex-shrink:0}

    /* â”€â”€ SITE SETTINGS â”€â”€ */
    .settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .color-input-wrap{display:flex;gap:8px;align-items:center}
    .color-input-wrap input[type=color]{width:40px;height:40px;border:none;padding:0;cursor:pointer;border-radius:var(--r-xs);overflow:hidden}
    .color-input-wrap .f-input{flex:1}

    /* â”€â”€ LIST ITEMS â”€â”€ */
    .list-item{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-sm);padding:16px 20px;display:flex;align-items:center;gap:16px;margin-bottom:10px;transition:box-shadow .2s}
    .list-item:hover{box-shadow:var(--shadow)}
    .list-thumb{width:62px;height:62px;border-radius:var(--r-xs);overflow:hidden;background:var(--surface2);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:22px}
    .list-thumb img{width:100%;height:100%;object-fit:cover}
    .list-info{flex:1;min-width:0}
    .list-title{font-weight:700;font-size:14px;margin-bottom:4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .list-meta{color:var(--text3);font-size:12px;display:flex;gap:10px}
    .list-actions{display:flex;gap:6px;flex-shrink:0}

    /* â”€â”€ MODAL â”€â”€ */
    .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:300;display:none;align-items:center;justify-content:center;padding:20px}
    .modal-bg.open{display:flex;animation:fadeIn .2s ease}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .modal{background:var(--surface);border-radius:var(--r);padding:28px;width:100%;max-width:440px;box-shadow:var(--shadow-lg);animation:slideUp .25s cubic-bezier(.16,1,.3,1)}
    @keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:none;opacity:1}}
    .modal h3{font-size:17px;font-weight:800;margin-bottom:20px;padding-bottom:14px;border-bottom:1px solid var(--border)}
    .modal-footer{display:flex;gap:8px;justify-content:flex-end;margin-top:20px}

    /* â”€â”€ TOAST â”€â”€ */
    .toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(120px);background:#111;color:#fff;padding:13px 28px;border-radius:50px;font-size:14px;font-weight:700;z-index:9999;transition:transform .35s cubic-bezier(.16,1,.3,1);box-shadow:0 8px 32px rgba(0,0,0,.25);white-space:nowrap;pointer-events:none}
    .toast.show{transform:translateX(-50%) translateY(0)}
    .toast.ok{background:var(--accent)}
    .toast.err{background:var(--red)}

    .spin{width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:sp .6s linear infinite;display:inline-block;vertical-align:middle}
    @keyframes sp{to{transform:rotate(360deg)}}

    /* â”€â”€ FOOTER â”€â”€ */
    footer{background:var(--text);color:rgba(255,255,255,.5);text-align:center;padding:28px;font-size:13px;margin-top:80px}
    footer a{color:rgba(255,255,255,.7);text-decoration:none}

    /* â”€â”€ 404 â”€â”€ */
    .p404{text-align:center;padding:100px 20px}
    .p404-num{font-size:130px;font-weight:900;color:var(--surface2);line-height:1;margin-bottom:16px}

    @media(max-width:768px){
      .admin-layout{grid-template-columns:1fr}
      .admin-sidebar{display:none}
      .f-grid{grid-template-columns:1fr}
      .settings-grid{grid-template-columns:1fr}
      .stats-grid{grid-template-columns:1fr}
      .slide-content{padding:40px 28px}
      .hdr{padding:0 16px}
      .main{padding:36px 16px}
    }


    /* Ù†Ù…Ø§ÛŒØ´ Ø¬Ø§ÛŒÚ¯Ø§Ù‡ ØªØ¨Ù„ÛŒØº Ø¯Ø± Ø§Ø¯ÛŒØªÙˆØ± ØªØ§ Ø§Ø¯Ù…ÛŒÙ† Ø¨ØªÙˆØ§Ù†Ø¯ Ø¢Ù† Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ø¯ */
.editor-body #pos-article-display-card-116213 {
  min-height: 60px;
  background: #f0fdf4;
  border: 2px dashed #16a34a;
  margin: 16px 0;
  display: flex;
  align-items: center;
  justify-content: center;
}
.editor-body #pos-article-display-card-116213::after {
  content: 'ğŸ“¢ Ø¬Ø§ÛŒÚ¯Ø§Ù‡ ØªØ¨Ù„ÛŒØº (Ø§ÛŒÙ† Ú©Ø§Ø¯Ø± Ø¯Ø± Ø³Ø§ÛŒØª Ø§ØµÙ„ÛŒ Ø¨Ø§ ØªØ¨Ù„ÛŒØº ÙˆØ§Ù‚Ø¹ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒØ´ÙˆØ¯)';
  color: #15803d;
  font-size: 13px;
  font-weight: bold;
}
  </style>
</head>
<body>

<script>
  const SB_URL   = 'https://tjztualnmoliusuoxpdx.supabase.co'
  const SB_KEY  = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRqenR1YWxubW9saXVzdW94cGR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0MzIyNDksImV4cCI6MjA4NzAwODI0OX0.PSMSMyUpejqXs3SOv0jLB15SMobyh6PKWvQQz_VEsBw'

  const PER_PAGE = 6
  const BASE_URL = 'https://mohamadalighane.github.io/daramad-noo/'
</script>

<!-- HEADER -->
<header id="hdr">
  <div class="hdr">
    <div class="logo" onclick="go('home')">
      <div class="logo-mark">ğŸ’°</div>
      <div class="logo-text">
        <div class="logo-name" id="siteNameDisplay">Ø¯Ø±Ø¢Ù…Ø¯ Ù†Ùˆ</div>
        <div class="logo-sub" id="siteDescDisplay">Ù…Ù‚Ø§Ù„Ø§Øª Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯</div>
      </div>
    </div>
    <nav class="hdr-nav">
      <button class="nav-link" onclick="go('home')">ğŸ  Ø®Ø§Ù†Ù‡</button>
      <button class="nav-link primary" onclick="go('admin')">âš™ Ù…Ø¯ÛŒØ±ÛŒØª</button>
    </nav>
  </div>
</header>

<div class="toast" id="toast"></div>

<!-- LINK MODAL -->
<div class="modal-bg" id="linkModal">
  <div class="modal">
    <h3>ğŸ”— Ø§ÙØ²ÙˆØ¯Ù† Ù„ÛŒÙ†Ú©</h3>
    <div class="f-group">
      <label class="f-label">Ù…ØªÙ† Ù„ÛŒÙ†Ú©</label>
      <input class="f-input" id="linkText" placeholder="Ù…ØªÙ† Ù†Ù…Ø§ÛŒØ´ÛŒ">
    </div>
    <div class="f-group">
      <label class="f-label">Ø¢Ø¯Ø±Ø³ URL</label>
      <input class="f-input" id="linkUrl" placeholder="https://...">
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('linkModal')">Ø§Ù†ØµØ±Ø§Ù</button>
      <button class="btn btn-primary" onclick="insertLink()">Ø§ÙØ²ÙˆØ¯Ù†</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page active" id="pg-home">

  <!-- HERO SLIDER -->
  <div class="slider-section" id="sliderSection">
    <div class="slides" id="slidesTrack"></div>
    <div class="slider-arrows">
      <button class="slider-arrow" onclick="slideNext()">â€¹</button>
      <button class="slider-arrow" onclick="slidePrev()">â€º</button>
    </div>
    <div class="slider-controls" id="sliderDots"></div>
  </div>

  <!-- ARTICLES -->
  <div class="main">
    <div style="margin-bottom:32px">
      <div class="search-bar">
        <input class="search-input" id="searchInput" type="text"
          placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù…Ù‚Ø§Ù„Ø§Øª..." oninput="onSearch(this.value)">
        <span class="search-icon">ğŸ”</span>
      </div>
    </div>
    <div class="section-header">
      <div class="section-title">Ø¢Ø®Ø±ÛŒÙ† Ù…Ù‚Ø§Ù„Ø§Øª</div>
      <div class="art-count" id="artCount"></div>
    </div>
    <div class="cat-filter" id="catFilter"></div>
    <div class="grid" id="artGrid"></div>
    <div class="pagination" id="pagination"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DETAIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page detail-outer" id="pg-detail">
  <div class="detail-wrap">
    <button class="back-btn" onclick="go('home')">â† Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù‚Ø§Ù„Ø§Øª</button>
    <div id="detailBody">
        <div id="pos-article-display-card-116213"></div>
    <div id="pos-article-text-116230"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOGIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="pg-login">
  <div class="login-page">
    <div class="login-card">
      <div class="login-icon">ğŸ”</div>
      <div class="login-title">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</div>
      <div class="login-sub">Ø¨Ø§ Ø§ÛŒÙ…ÛŒÙ„ Ùˆ Ø±Ù…Ø² Supabase ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯</div>
      <div class="alert alert-err" id="loginErr"></div>
      <div class="f-group">
        <label class="f-label">Ø§ÛŒÙ…ÛŒÙ„</label>
        <input class="f-input" id="loginEmail" type="email" placeholder="admin@daramad.com">
      </div>
      <div class="f-group">
        <label class="f-label">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
        <input class="f-input" id="loginPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
          onkeydown="if(event.key==='Enter')doLogin()">
      </div>
      <button class="btn btn-primary" id="loginBtn"
        style="width:100%;padding:14px;font-size:15px;justify-content:center;margin-top:4px"
        onclick="doLogin()">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…</button>
      <div style="text-align:center;margin-top:16px">
        <button class="btn btn-ghost" onclick="go('home')" style="font-size:12px">â† Ø¨Ø§Ø²Ú¯Ø´Øª</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADMIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="pg-admin">
  <div class="admin-layout">

    <!-- SIDEBAR -->
    <aside class="admin-sidebar">
      <div class="sidebar-logo">
        <div class="sidebar-logo-text">Ø¯Ø±Ø¢Ù…Ø¯ Ù†Ùˆ</div>
        <div class="sidebar-logo-sub">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</div>
      </div>
      <nav class="sidebar-nav">
        <div class="sidebar-section">Ù…Ù‚Ø§Ù„Ø§Øª</div>
        <button class="sidebar-item active" id="sb-articles" onclick="showAdminPanel('articles')">
          <span class="icon">ğŸ“‹</span> Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù‚Ø§Ù„Ø§Øª
        </button>
        <button class="sidebar-item" id="sb-new-article" onclick="showAdminPanel('new-article')">
          <span class="icon">âœï¸</span> Ù…Ù‚Ø§Ù„Ù‡ Ø¬Ø¯ÛŒØ¯
        </button>
        <div class="sidebar-section">Ø³Ø§ÛŒØª</div>
        <button class="sidebar-item" id="sb-slider" onclick="showAdminPanel('slider')">
          <span class="icon">ğŸ </span> Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø³Ù„Ø§ÛŒØ¯Ø±
        </button>
        <button class="sidebar-item" id="sb-settings" onclick="showAdminPanel('settings')">
          <span class="icon">âš™ï¸</span> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø§ÛŒØª
        </button>
        <div class="sidebar-section">Ú¯Ø²Ø§Ø±Ø´</div>
        <button class="sidebar-item" id="sb-stats" onclick="showAdminPanel('stats')">
          <span class="icon">ğŸ“Š</span> Ø¢Ù…Ø§Ø±
        </button>
      </nav>
      <div class="sidebar-footer">
        <button class="sidebar-item" onclick="go('home')" style="margin-bottom:6px">
          <span class="icon">ğŸ </span> Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø³Ø§ÛŒØª
        </button>
        <button class="sidebar-item" onclick="doLogout()">
          <span class="icon">ğŸšª</span> Ø®Ø±ÙˆØ¬
        </button>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="admin-main">
      <div class="admin-topbar">
        <div class="admin-topbar-title" id="adminTopbarTitle">Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù‚Ø§Ù„Ø§Øª</div>
        <div style="display:flex;gap:8px">
          <button class="btn btn-ghost" onclick="go('home')" style="font-size:12px">ğŸ  Ø³Ø§ÛŒØª</button>
          <button class="btn btn-danger" onclick="doLogout()" style="font-size:12px">Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>
      <div class="admin-content" id="adminContent"></div>
    </div>

  </div>
</div>

<div id="pos-article-display-116132"></div>


<!-- 404 -->
<div class="page" id="pg-404">
  <div class="p404">
    <div class="p404-num">404</div>
    <h2 style="font-size:26px;font-weight:900;margin-bottom:10px">ØµÙØ­Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯</h2>
    <p style="color:var(--text3);margin-bottom:28px">ØµÙØ­Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¯Ù†Ø¨Ø§Ù„Ø´ Ø¨ÙˆØ¯ÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>
    <button class="btn btn-primary" onclick="go('home')">ğŸ  Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø®Ø§Ù†Ù‡</button>
  </div>
</div>

<footer>
  <p>Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸ | <span id="footerSiteName">Ø¯Ø±Ø¢Ù…Ø¯ Ù†Ùˆ</span> &copy; Û±Û´Û°Û³</p>
</footer>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let sb = null
const sbReady = (() => {
  if (!SB_KEY || SB_KEY === 'YOUR_ANON_KEY_HERE') return false
  try { sb = window.supabase.createClient(SB_URL, SB_KEY); return true }
  catch { return false }
})()

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SITE SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SETTINGS_KEY = 'daramad_settings'
function getSiteSettings() {
  try {
    return JSON.parse(localStorage.getItem(SETTINGS_KEY)) || {
      siteName: 'Ø¯Ø±Ø¢Ù…Ø¯ Ù†Ùˆ',
      siteDesc: 'Ù…Ù‚Ø§Ù„Ø§Øª Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯',
      accentColor: '#16a34a',
      footerText: 'Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸ | Ø¯Ø±Ø¢Ù…Ø¯ Ù†Ùˆ'
    }
  } catch { return { siteName:'Ø¯Ø±Ø¢Ù…Ø¯ Ù†Ùˆ', siteDesc:'Ù…Ù‚Ø§Ù„Ø§Øª Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯', accentColor:'#16a34a', footerText:'Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸' } }
}
function saveSiteSettings(s) { localStorage.setItem(SETTINGS_KEY, JSON.stringify(s)) }
function applySiteSettings() {
  const s = getSiteSettings()
  document.getElementById('siteNameDisplay').textContent = s.siteName
  document.getElementById('siteDescDisplay').textContent = s.siteDesc
  document.getElementById('footerSiteName').textContent = s.siteName
  document.title = s.siteName + ' | Ù…Ù‚Ø§Ù„Ø§Øª Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯'
  document.documentElement.style.setProperty('--accent', s.accentColor)
  // derive shades
  document.documentElement.style.setProperty('--accent2', darkenColor(s.accentColor, 10))
}
function darkenColor(hex, pct) {
  const n = parseInt(hex.slice(1), 16)
  const r = Math.max(0, (n >> 16) - pct * 2)
  const g = Math.max(0, ((n >> 8) & 0xff) - pct * 2)
  const b = Math.max(0, (n & 0xff) - pct * 2)
  return '#' + [r,g,b].map(v => v.toString(16).padStart(2,'0')).join('')
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CATEGORIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEFAULT_CATS = ['Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯','ÙØ±ÛŒÙ„Ù†Ø³Ø±ÛŒ','Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ','Ú©Ø§Ø±Ø¢ÙØ±ÛŒÙ†ÛŒ','Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ø¨ÛŒ','Ø¢Ù…ÙˆØ²Ø´']
const CAT_KEY = 'daramad_cats'
function getCats() { try { return JSON.parse(localStorage.getItem(CAT_KEY)) || DEFAULT_CATS } catch { return DEFAULT_CATS } }
function saveCats(c) { localStorage.setItem(CAT_KEY, JSON.stringify(c)) }
function addCategory() {
  const inp = document.getElementById('newCatInput')
  const val = inp.value.trim()
  if (!val) return
  const cats = getCats()
  if (cats.includes(val)) { toast('Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯', 'err'); return }
  cats.push(val); saveCats(cats); inp.value = ''
  renderCatAdmin(); renderCatSelect()
  toast('Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ âœ“', 'ok')
}
function deleteCategory(cat) {
  if (!confirm(`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ "${cat}" Ø­Ø°Ù Ø´ÙˆØ¯ØŸ`)) return
  saveCats(getCats().filter(c => c !== cat))
  renderCatAdmin(); renderCatSelect()
}
function renderCatSelect() {
  const sel = document.getElementById('fCat')
  if (!sel) return
  const cur = sel.value
  sel.innerHTML = getCats().map(c => `<option value="${x(c)}">${x(c)}</option>`).join('')
  if (cur) sel.value = cur
}
function renderCatAdmin() {
  const el = document.getElementById('catTagsAdmin')
  if (!el) return
  el.innerHTML = getCats().map(c =>
    `<span class="cat-tag">${x(c)}<span class="del-cat" onclick="deleteCategory('${x(c)}')">Ã—</span></span>`
  ).join('')
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentPage = 1, totalCount = 0, searchQuery = '', activeCat = ''
let uploadedImageUrl = '', savedRange = null
let slideIndex = 0, slideTimer = null, slides = []

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function go(page, id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'))
  document.getElementById('hdr').style.display = page === 'login' ? 'none' : ''

  if (page === 'home') {
    show('pg-home'); currentPage = 1; resetSEO()
    loadArticles(); loadSlider()
    history.pushState(null, '', location.pathname)
  } else if (page === 'detail' && id) {
    show('pg-detail'); loadDetail(id)
    history.pushState(null, '', '?article=' + id)
  } else if (page === 'admin') {
    if (!sbReady) { alert('âš ï¸ Ú©Ù„ÛŒØ¯ Supabase Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†'); return }
    sb.auth.getSession().then(({ data: { session } }) => {
      if (session) { show('pg-admin'); showAdminPanel('articles') }
      else { document.getElementById('hdr').style.display = 'none'; show('pg-login') }
    })
  } else if (page === 'login') {
    document.getElementById('hdr').style.display = 'none'; show('pg-login')
  } else { show('pg-404') }
  window.scrollTo(0, 0)
}
function show(id) { document.getElementById(id).classList.add('active') }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function doLogin() {
  const email = document.getElementById('loginEmail').value.trim()
  const pass  = document.getElementById('loginPass').value
  const errEl = document.getElementById('loginErr')
  const btn   = document.getElementById('loginBtn')
  hide(errEl)
  if (!email || !pass) { showAlert(errEl, 'Ø§ÛŒÙ…ÛŒÙ„ Ùˆ Ø±Ù…Ø² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return }
  btn.innerHTML = '<span class="spin"></span> Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯...'
  btn.disabled = true
  const { error } = await sb.auth.signInWithPassword({ email, password: pass })
  btn.innerHTML = 'ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…'; btn.disabled = false
  if (error) { showAlert(errEl, error.message.includes('not confirmed') ? 'Ø§ÛŒÙ…ÛŒÙ„ ØªØ£ÛŒÛŒØ¯ Ù†Ø´Ø¯Ù‡' : 'Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡'); return }
  document.getElementById('hdr').style.display = ''
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'))
  show('pg-admin'); showAdminPanel('articles')
  toast('Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ âœ“', 'ok')
}
async function doLogout() { await sb.auth.signOut(); go('home'); toast('Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯', 'ok') }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SLIDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SLIDE_KEY = 'daramad_slides'
function getSlides() {
  try { return JSON.parse(localStorage.getItem(SLIDE_KEY)) || [] } catch { return [] }
}
function saveSlides(s) { localStorage.setItem(SLIDE_KEY, JSON.stringify(s)) }

function loadSlider() {
  slides = getSlides()
  const track = document.getElementById('slidesTrack')
  const dots  = document.getElementById('sliderDots')
  const section = document.getElementById('sliderSection')

  if (!slides.length) {
    section.style.display = 'none'; return
  }
  section.style.display = 'block'

  track.innerHTML = slides.map((s, i) => `
    <div class="slide ${i === 0 ? 'active' : ''}">
      <div class="slide-bg" style="background-image:url('${x(s.image || '')}');${!s.image ? 'background:linear-gradient(135deg,#111,#1a2e1a)' : ''}"></div>
      <div class="slide-content">
        ${s.badge ? `<div class="slide-badge">âœ¨ ${x(s.badge)}</div>` : ''}
        <h2 class="slide-title">${x(s.title)}</h2>
        ${s.desc ? `<p class="slide-desc">${x(s.desc)}</p>` : ''}
        ${s.btn && s.link ? `<button class="slide-btn" onclick="go('detail',${s.link})">${x(s.btn)}</button>` : ''}
      </div>
    </div>`).join('')

  dots.innerHTML = slides.map((_, i) =>
    `<button class="dot ${i === 0 ? 'active' : ''}" onclick="goSlide(${i})"></button>`
  ).join('')

  slideIndex = 0
  clearInterval(slideTimer)
  if (slides.length > 1) slideTimer = setInterval(slideNext, 5000)
}

function goSlide(i) {
  const track = document.getElementById('slidesTrack')
  const allSlides = track.querySelectorAll('.slide')
  const allDots   = document.getElementById('sliderDots').querySelectorAll('.dot')
  allSlides.forEach((s, j) => { s.classList.toggle('active', j === i) })
  allDots.forEach((d, j) => { d.classList.toggle('active', j === i) })
  track.style.transform = `translateX(${i * 100}%)`
  slideIndex = i
  clearInterval(slideTimer)
  if (slides.length > 1) slideTimer = setInterval(slideNext, 5000)
}
function slideNext() { goSlide((slideIndex + 1) % Math.max(slides.length, 1)) }
function slidePrev() { goSlide((slideIndex - 1 + Math.max(slides.length, 1)) % Math.max(slides.length, 1)) }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ARTICLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let searchTimer
function onSearch(v) {
  clearTimeout(searchTimer)
  searchTimer = setTimeout(() => { searchQuery = v; currentPage = 1; loadArticles() }, 300)
}

async function loadArticles() {
  const grid = document.getElementById('artGrid')
  const cnt  = document.getElementById('artCount')
  const pag  = document.getElementById('pagination')
  if (!sbReady) {
    grid.innerHTML = `<div class="empty"><div class="empty-icon">âš™ï¸</div><h3>Ú©Ù„ÛŒØ¯ Supabase ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡</h3><p>Ù…Ù‚Ø¯Ø§Ø± YOUR_ANON_KEY_HERE Ø±Ø§ Ø¯Ø± ÙØ§ÛŒÙ„ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†</p></div>`
    return
  }
  grid.innerHTML = spinning(); pag.innerHTML = ''
  loadCatFilter()
  const from = (currentPage - 1) * PER_PAGE
  const to   = from + PER_PAGE - 1
  let q = sb.from('articles').select('*', { count: 'exact' })
    .order('created_at', { ascending: false }).range(from, to)
  if (searchQuery.trim()) q = q.or(`title.ilike.%${searchQuery}%,short_description.ilike.%${searchQuery}%`)
  if (activeCat) q = q.eq('category', activeCat)
  const { data, error, count } = await q
  if (error) { grid.innerHTML = errHtml(error.message); return }
  totalCount = count || 0
  cnt.textContent = totalCount > 0 ? `${totalCount} Ù…Ù‚Ø§Ù„Ù‡` : ''
  if (!data || !data.length) {
    grid.innerHTML = `<div class="empty"><div class="empty-icon">${searchQuery || activeCat ? 'ğŸ”' : 'ğŸ“‚'}</div>
      <h3>${searchQuery || activeCat ? 'Ù…Ù‚Ø§Ù„Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯' : 'Ù‡Ù†ÙˆØ² Ù…Ù‚Ø§Ù„Ù‡â€ŒØ§ÛŒ Ù†ÛŒØ³Øª'}</h3>
      <p>${searchQuery || activeCat ? 'ÙÛŒÙ„ØªØ± Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯' : 'Ø§Ø² Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† Ù…Ù‚Ø§Ù„Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯'}</p>
    </div>`
    return
  }
  grid.innerHTML = data.map(a => `
    <div class="card" onclick="go('detail',${a.id})">
      <div class="card-img-wrap">
        ${a.image
          ? `<img class="card-img" src="${x(a.image)}" alt="${x(a.title)}" loading="lazy"
                onerror="this.style.display='none';this.parentElement.querySelector('.card-ph').style.display='flex'">`
          : ''}
        <div class="card-ph" ${a.image ? 'style="display:none"' : ''}>ğŸ“„</div>
        ${a.category ? `<div class="card-cat-badge">${x(a.category)}</div>` : ''}
      </div>
      <div class="card-body">
        <div class="card-date">ğŸ“… ${fd(a.created_at)}</div>
        <div class="card-title">${x(a.title)}</div>
        <div class="card-desc">${stripHtml(a.short_description)}</div>
        <div class="card-foot">
          <span class="read-more">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¨ÛŒØ´ØªØ±</span>
        </div>
      </div>
    </div>`).join('')

  const totalPages = Math.ceil(totalCount / PER_PAGE)
  if (totalPages > 1) renderPagination(currentPage, totalPages)
}

async function loadCatFilter() {
  const el = document.getElementById('catFilter')
  const { data } = await sb.from('articles').select('category').not('category', 'is', null)
  if (!data) return
  const cats = [...new Set(data.map(r => r.category).filter(Boolean))]
  el.innerHTML = `<button class="cat-chip ${!activeCat ? 'active' : ''}" onclick="filterCat('')">Ù‡Ù…Ù‡</button>` +
    cats.map(c => `<button class="cat-chip ${activeCat === c ? 'active' : ''}" onclick="filterCat('${x(c)}')">${x(c)}</button>`).join('')
}
function filterCat(cat) { activeCat = cat; currentPage = 1; loadArticles() }

function renderPagination(cur, total) {
  const pag = document.getElementById('pagination')
  let html = `<button class="pg-btn" onclick="goPage(${cur-1})" ${cur===1?'disabled':''}>â€º</button>`
  for (let i = 1; i <= total; i++) {
    if (i===1||i===total||(i>=cur-2&&i<=cur+2)) html += `<button class="pg-btn ${i===cur?'active':''}" onclick="goPage(${i})">${i}</button>`
    else if (i===cur-3||i===cur+3) html += `<span class="pg-sep">...</span>`
  }
  html += `<button class="pg-btn" onclick="goPage(${cur+1})" ${cur===total?'disabled':''}>â€¹</button>`
  html += `<span class="pg-sep" style="font-size:12px">${cur} Ø§Ø² ${total}</span>`
  pag.innerHTML = html
}
function goPage(p) { currentPage = p; loadArticles(); window.scrollTo({ top: 0, behavior: 'smooth' }) }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadDetail(id) {
  const body = document.getElementById('detailBody')
  body.innerHTML = spinning(true)
  const { data: a, error } = await sb.from('articles').select('*').eq('id', id).single()
  if (error || !a) {
    body.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text3)"><div style="font-size:56px;margin-bottom:16px">ğŸ˜•</div><p>Ù…Ù‚Ø§Ù„Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯</p></div>`
    return
  }
  document.title = a.title + ' | ' + getSiteSettings().siteName
  setArticleSEO(a)
  const embed = ytEmbed(a.video_link)
  const videoHtml = a.video_link
    ? (embed
        ? `<div class="video-frame"><iframe src="${embed}" allowfullscreen loading="lazy"></iframe></div>`
        : `<a class="video-link-btn" href="${x(a.video_link)}" target="_blank" rel="noopener">â–¶ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙˆÛŒØ¯ÛŒÙˆ</a>`)
    : ''
  body.innerHTML = `
    ${a.image ? `<img class="detail-img" src="${x(a.image)}" alt="${x(a.title)}" loading="lazy">` : ''}
    <h1 class="detail-title">${x(a.title)}</h1>
    <div class="detail-meta">
      <span class="detail-meta-item">ğŸ“… ${fd(a.created_at)}</span>
      ${a.category ? `<span class="detail-badge">${x(a.category)}</span>` : ''}
    </div>
    <div class="detail-actions">
      <button class="btn btn-primary" onclick="downloadPDF()">ğŸ“„ Ø¯Ø§Ù†Ù„ÙˆØ¯ PDF</button>
      <button class="btn btn-ghost" onclick="copyLink()" id="copyLinkBtn">ğŸ”— Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©</button>
      <a class="btn btn-ghost" id="shareWa" href="" target="_blank" rel="noopener">ğŸ“² ÙˆØ§ØªØ³Ø§Ù¾</a>
      <a class="btn btn-ghost" id="shareTg" href="" target="_blank" rel="noopener">âœˆï¸ ØªÙ„Ú¯Ø±Ø§Ù…</a>
    </div>
    ${videoHtml}
    <div class="rich-content" id="articleContent">${processContent(a.full_content)}</div>`
  window._currentArticle = a
  const url = encodeURIComponent(location.origin + location.pathname + '?article=' + a.id)
  const txt = encodeURIComponent(a.title + ' | ' + getSiteSettings().siteName)
  document.getElementById('shareWa').href = `https://wa.me/?text=${txt}%20${url}`
  document.getElementById('shareTg').href = `https://t.me/share/url?url=${url}&text=${txt}`
  setTimeout(() => {
    document.querySelectorAll('#articleContent pre').forEach(pre => {
      const wrap = document.createElement('div'); wrap.className = 'code-block'
      pre.parentNode.insertBefore(wrap, pre); wrap.appendChild(pre)
      const btn = document.createElement('button'); btn.className = 'copy-btn'; btn.textContent = 'ğŸ“‹ Ú©Ù¾ÛŒ'
      btn.onclick = () => { navigator.clipboard.writeText(pre.textContent); btn.textContent = 'âœ… Ú©Ù¾ÛŒ Ø´Ø¯'; setTimeout(() => btn.textContent = 'ğŸ“‹ Ú©Ù¾ÛŒ', 2000) }
      wrap.appendChild(btn)
    })
  }, 100)
}

function processContent(html) {
  if (!html) return ''
  if (!/<[a-z][\s\S]*>/i.test(html)) {
    return html.split('\n').map(l => l.trim() ? '<p>' + x(l) + '</p>' : '').filter(Boolean).join('')
  }
  return html
}

function copyLink() {
  navigator.clipboard.writeText(location.href)
  const btn = document.getElementById('copyLinkBtn')
  btn.textContent = 'âœ… Ú©Ù¾ÛŒ Ø´Ø¯'; setTimeout(() => btn.textContent = 'ğŸ”— Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©', 2500)
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PDF â€” Ø¨Ø§ html2canvas (ÙØ§Ø±Ø³ÛŒ Ú©Ø§Ù…Ù„)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function downloadPDF() {
  const a = window._currentArticle
  if (!a) return
  toast('Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª PDF...', '')

  const div = document.createElement('div')
  div.style.cssText = 'position:fixed;top:-9999px;left:0;width:794px;background:#fff;font-family:Vazirmatn,sans-serif;direction:rtl;'
  const s = getSiteSettings()
  div.innerHTML = `
    <div style="background:${s.accentColor};color:#fff;padding:16px 36px;display:flex;justify-content:space-between;align-items:center;font-size:13px;font-family:Vazirmatn,sans-serif">
      <span style="font-weight:900;font-size:16px">${x(s.siteName)}</span>
      <span>${fd(a.created_at)}</span>
    </div>
    <div style="padding:36px 48px 48px;font-family:Vazirmatn,sans-serif">
      ${a.image ? `<img src="${a.image}" crossorigin="anonymous" style="width:100%;max-height:320px;object-fit:cover;border-radius:12px;margin-bottom:28px;display:block">` : ''}
      <h1 style="font-size:26px;font-weight:900;margin-bottom:14px;line-height:1.35;color:#111827;font-family:Vazirmatn,sans-serif">${x(a.title)}</h1>
      <div style="display:flex;gap:12px;align-items:center;margin-bottom:20px;font-size:12px;color:#9ca3af;font-family:Vazirmatn,sans-serif">
        <span>ğŸ“… ${fd(a.created_at)}</span>
        ${a.category ? `<span style="background:#dcfce7;color:#16a34a;padding:3px 12px;border-radius:20px;font-weight:700">${x(a.category)}</span>` : ''}
      </div>
      <div style="background:#fffbeb;border-right:4px solid #d97706;padding:14px 18px;border-radius:0 8px 8px 0;margin-bottom:28px;font-size:13px;color:#374151;font-style:italic;line-height:1.7;font-family:Vazirmatn,sans-serif">
        ${x(a.short_description)}
      </div>
      <div style="color:#374151;line-height:1.9;font-size:14px;font-family:Vazirmatn,sans-serif">
        ${a.full_content || ''}
      </div>
      <div style="margin-top:48px;padding-top:16px;border-top:1px solid #e5e7eb;font-size:11px;color:#9ca3af;text-align:center;font-family:Vazirmatn,sans-serif">
        ${x(s.siteName)} | ${BASE_URL}
      </div>
    </div>`
  document.body.appendChild(div)

  try {
    await new Promise(r => setTimeout(r, 400))
    const canvas = await html2canvas(div, { scale: 2, useCORS: true, allowTaint: true, backgroundColor: '#fff', logging: false, width: 794 })
    document.body.removeChild(div)
    const { jsPDF } = window.jspdf
    const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' })
    const pw = 210, ph = 297
    const imgH = (canvas.height * pw) / canvas.width
    let y = 0, page = 0
    const img = canvas.toDataURL('image/jpeg', 0.92)
    while (y < imgH) {
      if (page > 0) doc.addPage()
      doc.addImage(img, 'JPEG', 0, -y, pw, imgH)
      y += ph; page++
    }
    doc.save(a.title + '.pdf')
    toast('PDF Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯ âœ“', 'ok')
  } catch (e) {
    if (document.body.contains(div)) document.body.removeChild(div)
    toast('Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®Øª PDF', 'err'); console.error(e)
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  IMAGE UPLOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function handleImageFile(input) {
  const file = input.files[0]
  if (!file) return
  if (file.size > 5 * 1024 * 1024) { toast('Ø­Ø¬Ù… Ø¹Ú©Ø³ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ûµ Ù…Ú¯Ø§Ø¨Ø§ÛŒØª', 'err'); return }
  const reader = new FileReader()
  reader.onload = e => {
    const p = document.getElementById('uploadPreview')
    if (p) { p.src = e.target.result; p.style.display = 'block' }
    const ph = document.getElementById('uploadPlaceholder')
    if (ph) ph.style.display = 'none'
  }
  reader.readAsDataURL(file)
  const { data: { session } } = await sb.auth.getSession()
  if (!session) { toast('Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ø¨Ø§ÛŒØ¯ Ù„Ø§Ú¯ÛŒÙ† Ø¨Ø§Ø´ÛŒ', 'err'); return }
  const bar = document.getElementById('uploadBar')
  const barWrap = document.getElementById('uploadBarWrap')
  if (barWrap) barWrap.style.display = 'block'
  if (bar) bar.style.width = '45%'
  const ext = file.name.split('.').pop()
  const fileName = Date.now() + '-' + Math.random().toString(36).slice(2) + '.' + ext
  if (bar) bar.style.width = '75%'
  const { error } = await sb.storage.from('article-images').upload(fileName, file, { cacheControl: '3600' })
  if (bar) bar.style.width = '100%'
  if (error) { toast('Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯: ' + error.message, 'err'); if (barWrap) barWrap.style.display = 'none'; return }
  const { data: urlData } = sb.storage.from('article-images').getPublicUrl(fileName)
  uploadedImageUrl = urlData.publicUrl
  const fi = document.getElementById('fImageFinal')
  const fu = document.getElementById('fImageUrl')
  if (fi) fi.value = uploadedImageUrl
  if (fu) fu.value = ''
  setTimeout(() => { if (barWrap) barWrap.style.display = 'none'; if (bar) bar.style.width = '0' }, 600)
  toast('Ø¹Ú©Ø³ Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯ âœ“', 'ok')
}
function onImageUrlInput(val) {
  if (!val) return
  uploadedImageUrl = ''
  const fi = document.getElementById('fImageFinal')
  if (fi) fi.value = val
  const p = document.getElementById('uploadPreview')
  if (p) { p.src = val; p.style.display = 'block' }
  const ph = document.getElementById('uploadPlaceholder')
  if (ph) ph.style.display = 'none'
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RICH TEXT EDITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function execCmd(cmd, val = null) {
  document.getElementById('editorBody').focus()
  document.execCommand(cmd, false, val)
  updateWordCount()
}
function insertBlockquote() {
  const t = window.getSelection()?.toString() || 'Ù†Ù‚Ù„â€ŒÙ‚ÙˆÙ„ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯'
  document.execCommand('insertHTML', false, `<blockquote>${t}</blockquote><p><br></p>`)
}
function insertCode() {
  const t = window.getSelection()?.toString() || 'Ú©Ø¯'
  document.execCommand('insertHTML', false, `<code>${t}</code>`)
}
function insertCodeBlock() {
  document.execCommand('insertHTML', false, `<pre>// Ú©Ø¯ Ø§ÛŒÙ†Ø¬Ø§\nconsole.log('Hello')</pre><p><br></p>`)
}

function insertHR() { document.execCommand('insertHTML', false, '<hr><p><br></p>') }

// ØªØ§Ø¨Ø¹ Ø¯Ø±Ø¬ ØªØ¨Ù„ÛŒØº Ø¯Ø± Ø§Ø¯ÛŒØªÙˆØ±
function insertAd() {
  // Ù…Ø§ Ú©Ø¯ ØªØ¨Ù„ÛŒØº Ø´Ù…Ø§ Ø±Ø§ Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³ÛŒÙ… Ùˆ ÛŒÚ© Ø®Ø· Ø®Ø§Ù„ÛŒ (<p><br></p>) Ø¨Ø¹Ø¯ Ø§Ø² Ø¢Ù† Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±ÛŒÙ… ØªØ§ Ø¨ØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ù‡ Ù†ÙˆØ´ØªÙ† Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ù‡ÛŒØ¯
  const adCode = '<div id="pos-article-display-card-116213"></div><p><br></p>';
  
  // Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± Ú©Ø¯ Ø¨Ø§Ù„Ø§ Ø±Ø§ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ø¯Ø± Ø¬Ø§ÛŒÛŒ Ú©Ù‡ Ù…ÙˆØ³ Ù‡Ø³Øª Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
  document.execCommand('insertHTML', false, adCode);
  
  // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„Ù…Ø§Øª Ù…Ù‚Ø§Ù„Ù‡
  updateWordCount();
}

function openLinkModal() {
  const sel = window.getSelection()
  if (sel && sel.rangeCount > 0) savedRange = sel.getRangeAt(0).cloneRange()
  document.getElementById('linkText').value = sel?.toString() || ''
  document.getElementById('linkUrl').value = ''
  document.getElementById('linkModal').classList.add('open')
}
function closeModal(id) { document.getElementById(id || 'linkModal').classList.remove('open') }
function insertLink() {
  const text = document.getElementById('linkText').value.trim()
  const url  = document.getElementById('linkUrl').value.trim()
  if (!url) { toast('Ø¢Ø¯Ø±Ø³ Ù„ÛŒÙ†Ú© Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†', 'err'); return }
  document.getElementById('editorBody').focus()
  if (savedRange) { const s = window.getSelection(); s.removeAllRanges(); s.addRange(savedRange) }
  document.execCommand('insertHTML', false, `<a href="${x(url)}" target="_blank" rel="noopener">${x(text || url)}</a>`)
  closeModal(); savedRange = null
}
function updateWordCount() {
  const el = document.getElementById('wordCount')
  if (!el) return
  const words = (document.getElementById('editorBody')?.innerText || '').trim().split(/\s+/).filter(w => w).length
  el.textContent = words + ' Ú©Ù„Ù…Ù‡'
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ADMIN PANELS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showAdminPanel(name) {
  // update sidebar active
  document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'))
  const sb = document.getElementById('sb-' + name)
  if (sb) sb.classList.add('active')

  const titles = {
    articles: 'Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù‚Ø§Ù„Ø§Øª', 'new-article': 'Ù…Ù‚Ø§Ù„Ù‡ Ø¬Ø¯ÛŒØ¯',
    slider: 'Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø³Ù„Ø§ÛŒØ¯Ø±', settings: 'ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø§ÛŒØª', stats: 'Ø¢Ù…Ø§Ø± Ø³Ø§ÛŒØª'
  }
  document.getElementById('adminTopbarTitle').textContent = titles[name] || ''

  const c = document.getElementById('adminContent')
  if (name === 'articles')    renderArticlesList(c)
  if (name === 'new-article') renderArticleForm(c)
  if (name === 'slider')      renderSliderAdmin(c)
  if (name === 'settings')    renderSettingsAdmin(c)
  if (name === 'stats')       renderStatsAdmin(c)
}

// â”€â”€ ARTICLES LIST â”€â”€
async function renderArticlesList(c) {
  c.innerHTML = spinning(true)
  const { data, error } = await sb.from('articles').select('*').order('created_at', { ascending: false })
  if (error) { c.innerHTML = errHtml(error.message); return }
  const newBtn = `<div style="margin-bottom:20px"><button class="btn btn-primary" onclick="showAdminPanel('new-article')">âœï¸ Ù…Ù‚Ø§Ù„Ù‡ Ø¬Ø¯ÛŒØ¯</button></div>`
  if (!data.length) {
    c.innerHTML = newBtn + `<div class="panel"><div style="text-align:center;padding:40px;color:var(--text3)"><div style="font-size:48px;margin-bottom:12px">ğŸ“‚</div><p>Ù‡Ù†ÙˆØ² Ù…Ù‚Ø§Ù„Ù‡â€ŒØ§ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯</p></div></div>`
    return
  }
  c.innerHTML = newBtn + `<div class="panel">` +
    data.map(a => `
      <div class="list-item">
        <div class="list-thumb">${a.image ? `<img src="${x(a.image)}" onerror="this.parentElement.textContent='ğŸ“„'">` : 'ğŸ“„'}</div>
        <div class="list-info">
          <div class="list-title">${x(a.title)}</div>
          <div class="list-meta"><span>ğŸ“… ${fd(a.created_at)}</span>${a.category ? `<span>ğŸ· ${x(a.category)}</span>` : ''}</div>
        </div>
        <div class="list-actions">
          <button class="btn btn-ghost" style="padding:7px 12px;font-size:12px" onclick="go('detail',${a.id})">ğŸ‘</button>
          <button class="btn btn-warn" style="font-size:12px" onclick="editArticle(${a.id})">âœ ÙˆÛŒØ±Ø§ÛŒØ´</button>
          <button class="btn btn-danger" style="font-size:12px" onclick="deleteArticle(${a.id})">ğŸ—‘</button>
        </div>
      </div>`).join('') + `</div>`
}

// â”€â”€ ARTICLE FORM â”€â”€
function renderArticleForm(c, article = null) {
  const isEdit = !!article
  c.innerHTML = `
    <div class="panel">
      <div class="panel-title">${isEdit ? 'âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ù‚Ø§Ù„Ù‡' : 'âœï¸ Ù…Ù‚Ø§Ù„Ù‡ Ø¬Ø¯ÛŒØ¯'}</div>
      <div class="alert alert-err" id="formErr"></div>
      <div class="alert alert-ok"  id="formOk"></div>
      <input type="hidden" id="editId" value="${isEdit ? article.id : ''}">
      <div class="f-grid">
        <div class="f-group f-full">
          <label class="f-label">Ø¹Ù†ÙˆØ§Ù† Ù…Ù‚Ø§Ù„Ù‡ *</label>
          <input class="f-input" id="fTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ù…Ù‚Ø§Ù„Ù‡" value="${isEdit ? x(article.title) : ''}">
        </div>
        <div class="f-group f-full">
          <label class="f-label">ØªØµÙˆÛŒØ± Ù…Ù‚Ø§Ù„Ù‡</label>
          <div class="upload-area">
            <input type="file" id="fImageFile" accept="image/*" onchange="handleImageFile(this)">
            <div id="uploadPlaceholder">
              <div style="font-size:28px;margin-bottom:6px">ğŸ–¼</div>
              <div style="font-size:13px;font-weight:600;color:var(--text2)">Ø¹Ú©Ø³ Ø±Ø§ Ø¨Ú©Ø´ ÛŒØ§ Ú©Ù„ÛŒÚ© Ú©Ù†</div>
              <div style="font-size:11px;color:var(--text3);margin-top:3px">JPGØŒ PNG â€” Ø­Ø¯Ø§Ú©Ø«Ø± Ûµ Ù…Ú¯Ø§Ø¨Ø§ÛŒØª</div>
            </div>
            <img id="uploadPreview" class="upload-preview" ${isEdit && article.image ? `src="${x(article.image)}" style="display:block"` : ''}>
            <div class="upload-bar-wrap" id="uploadBarWrap"><div class="upload-bar" id="uploadBar"></div></div>
          </div>
          <div style="margin-top:8px;display:flex;align-items:center;gap:8px">
            <span style="font-size:12px;color:var(--text3);white-space:nowrap">ÛŒØ§ Ù„ÛŒÙ†Ú©:</span>
            <input class="f-input" id="fImageUrl" type="url" placeholder="https://..." oninput="onImageUrlInput(this.value)" value="${isEdit ? x(article.image || '') : ''}">
          </div>
          <input type="hidden" id="fImageFinal" value="${isEdit ? x(article.image || '') : ''}">
        </div>
        <div class="f-group">
          <label class="f-label">Ù„ÛŒÙ†Ú© ÙˆÛŒØ¯ÛŒÙˆ</label>
          <input class="f-input" id="fVideo" type="url" placeholder="https://youtube.com/..." value="${isEdit ? x(article.video_link || '') : ''}">
        </div>
        <div class="f-group">
          <label class="f-label">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
          <select class="f-select" id="fCat"></select>
          <div class="cat-manager">
            <div class="cat-manager-title">Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</div>
            <div class="cat-tags" id="catTagsAdmin"></div>
            <div class="cat-add-row">
              <input class="cat-add-input" id="newCatInput" placeholder="Ø¯Ø³ØªÙ‡ Ø¬Ø¯ÛŒØ¯..."
                onkeydown="if(event.key==='Enter'){event.preventDefault();addCategory()}">
              <button class="cat-add-btn" onclick="addCategory()">+ Ø§Ø¶Ø§ÙÙ‡</button>
            </div>
          </div>
        </div>
        <div class="f-group f-full">
          <label class="f-label">ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡ *</label>
          <input class="f-input" id="fShort" placeholder="ÛŒÚ© Ø¬Ù…Ù„Ù‡ Ø®Ù„Ø§ØµÙ‡" value="${isEdit ? x(article.short_description) : ''}">
        </div>
        <div class="f-group f-full">
          <label class="f-label">Ù…ØªÙ† Ú©Ø§Ù…Ù„ Ù…Ù‚Ø§Ù„Ù‡ *</label>
          <div class="editor-wrap">
            <div class="editor-toolbar">
              <select class="tb-select" onchange="execCmd('formatBlock',this.value);this.value='p'">
                <option value="p">Ù…ØªÙ† Ø¹Ø§Ø¯ÛŒ</option>
                <option value="h1">Ø¹Ù†ÙˆØ§Ù† Û±</option>
                <option value="h2">Ø¹Ù†ÙˆØ§Ù† Û²</option>
                <option value="h3">Ø¹Ù†ÙˆØ§Ù† Û³</option>
              </select>

              <div class="tb-sep"></div>
              <button class="tb-btn" onclick="execCmd('bold')" title="Ø¨ÙˆÙ„Ø¯"><b>B</b></button>
              <button class="tb-btn" onclick="execCmd('italic')" title="Ø§ÛŒØªØ§Ù„ÛŒÚ©"><i>I</i></button>
              <button class="tb-btn" onclick="execCmd('underline')" title="Ø®Ø· Ø²ÛŒØ±"><u>U</u></button>
              <button class="tb-btn" onclick="execCmd('strikeThrough')" title="Ø®Ø· ÙˆØ³Ø·"><s>S</s></button>
              <div class="tb-sep"></div>
              <button class="tb-btn" onclick="execCmd('insertUnorderedList')" title="Ù„ÛŒØ³Øª Ù†Ù‚Ø·Ù‡â€ŒØ§ÛŒ">â˜°</button>
              <button class="tb-btn" onclick="execCmd('insertOrderedList')" title="Ù„ÛŒØ³Øª Ø´Ù…Ø§Ø±Ù‡â€ŒØ§ÛŒ">1.</button>
              <div class="tb-sep"></div>
              <button class="tb-btn" onclick="insertBlockquote()" title="Ù†Ù‚Ù„â€ŒÙ‚ÙˆÙ„">â</button>
              <button class="tb-btn" onclick="insertCode()" title="Ú©Ø¯ inline">{ }</button>
              <button class="tb-btn" onclick="insertCodeBlock()" title="Ø¨Ù„Ø§Ú© Ú©Ø¯">ğŸ“‹</button>
              <button class="tb-btn" onclick="insertHR()" title="Ø®Ø· Ø¬Ø¯Ø§">â€”</button>
              <button class="tb-btn" onclick="insertAd()" title="Ø¯Ø±Ø¬ ØªØ¨Ù„ÛŒØº">ğŸ“¢</button>
              <div class="tb-sep"></div>
              <button class="tb-btn" onclick="openLinkModal()" title="Ù„ÛŒÙ†Ú©">ğŸ”—</button>
              <button class="tb-btn" onclick="execCmd('unlink')" title="Ø­Ø°Ù Ù„ÛŒÙ†Ú©">ğŸš«</button>
              <div class="tb-sep"></div>
              <button class="tb-btn" onclick="execCmd('justifyRight')" title="Ø±Ø§Ø³Øª">â‡¥</button>
              <button class="tb-btn" onclick="execCmd('justifyCenter')" title="ÙˆØ³Ø·">â‰¡</button>
              <button class="tb-btn" onclick="execCmd('justifyLeft')" title="Ú†Ù¾">â‡¤</button>
              <div class="tb-sep"></div>
              <button class="tb-btn" onclick="execCmd('undo')" title="ÙˆØ§Ú¯Ø±Ø¯">â†©</button>
              <button class="tb-btn" onclick="execCmd('redo')" title="Ø§Ù†Ø¬Ø§Ù… Ù…Ø¬Ø¯Ø¯">â†ª</button>
            </div>
            <div class="editor-body" id="editorBody" contenteditable="true"
              data-placeholder="Ù…ØªÙ† Ù…Ù‚Ø§Ù„Ù‡ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."
              oninput="updateWordCount()">${isEdit ? (article.full_content || '') : ''}</div>
            <div class="editor-footer">
              <span id="wordCount">Û° Ú©Ù„Ù…Ù‡</span>
              <span>Ctrl+B Ø¨ÙˆÙ„Ø¯ | Ctrl+I Ø§ÛŒØªØ§Ù„ÛŒÚ©</span>
            </div>
          </div>
        </div>
      </div>
      <div style="display:flex;gap:10px;margin-top:20px">
        <button class="btn btn-primary" id="saveBtn" onclick="saveArticle()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ù…Ù‚Ø§Ù„Ù‡</button>
        <button class="btn btn-ghost" onclick="showAdminPanel('articles')">Ø§Ù†ØµØ±Ø§Ù</button>
      </div>
    </div>`
  renderCatSelect()
  renderCatAdmin()
  if (isEdit && article.category) {
    const sel = document.getElementById('fCat')
    if (sel) sel.value = article.category
  }
  if (isEdit && article.image) {
    const ph = document.getElementById('uploadPlaceholder')
    if (ph) ph.style.display = 'none'
  }
  updateWordCount()
}

async function editArticle(id) {
  const { data: a } = await sb.from('articles').select('*').eq('id', id).single()
  if (!a) return
  showAdminPanel('new-article')
  const c = document.getElementById('adminContent')
  renderArticleForm(c, a)
}

async function saveArticle() {
  const title   = document.getElementById('fTitle')?.value.trim()
  const image   = document.getElementById('fImageFinal')?.value.trim() || document.getElementById('fImageUrl')?.value.trim()
  const video   = document.getElementById('fVideo')?.value.trim()
  const short   = document.getElementById('fShort')?.value.trim()
  const content = document.getElementById('editorBody')?.innerHTML.trim()
  const cat     = document.getElementById('fCat')?.value
  const editId  = document.getElementById('editId')?.value
  const errEl   = document.getElementById('formErr')
  const okEl    = document.getElementById('formOk')
  const btn     = document.getElementById('saveBtn')
  hide(errEl); hide(okEl)
  if (!title)   { showAlert(errEl, 'âš ï¸ Ø¹Ù†ÙˆØ§Ù† Ù…Ù‚Ø§Ù„Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return }
  if (!short)   { showAlert(errEl, 'âš ï¸ ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return }
  if (!content || content === '<br>') { showAlert(errEl, 'âš ï¸ Ù…ØªÙ† Ù…Ù‚Ø§Ù„Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return }
  btn.innerHTML = '<span class="spin"></span> Ø°Ø®ÛŒØ±Ù‡...'; btn.disabled = true
  const payload = { title, image, video_link: video, short_description: short, full_content: content, category: cat }
  const { error } = editId
    ? await sb.from('articles').update(payload).eq('id', editId)
    : await sb.from('articles').insert([payload])
  btn.innerHTML = 'ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ù…Ù‚Ø§Ù„Ù‡'; btn.disabled = false
  if (error) {
    let msg = 'Ø®Ø·Ø§: ' + error.message
    if (error.message.includes('policy')) msg = 'âš ï¸ Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ø¯ Ø´Ø¯ â€” Ù„Ø§Ú¯ÛŒÙ† Ù‡Ø³ØªÛŒØŸ'
    showAlert(errEl, msg); return
  }
  showAlert(okEl, editId ? 'âœ… Ù…Ù‚Ø§Ù„Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯' : 'âœ… Ù…Ù‚Ø§Ù„Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯')
  toast(editId ? 'Ù…Ù‚Ø§Ù„Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯ âœ“' : 'Ù…Ù‚Ø§Ù„Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ âœ“', 'ok')
  setTimeout(() => showAdminPanel('articles'), 1000)
}

async function deleteArticle(id) {
  if (!confirm('Ø§ÛŒÙ† Ù…Ù‚Ø§Ù„Ù‡ Ø­Ø°Ù Ø´ÙˆØ¯ØŸ')) return
  const { error } = await sb.from('articles').delete().eq('id', id)
  if (error) { toast('Ø®Ø·Ø§: ' + error.message, 'err'); return }
  toast('Ù…Ù‚Ø§Ù„Ù‡ Ø­Ø°Ù Ø´Ø¯', 'ok')
  showAdminPanel('articles')
}

// â”€â”€ SLIDER ADMIN â”€â”€
function renderSliderAdmin(c) {
  const slides = getSlides()
  c.innerHTML = `
    <div class="panel">
      <div class="panel-title">ğŸ  Ø§Ø³Ù„Ø§ÛŒØ¯Ù‡Ø§ÛŒ ÙØ¹Ù„ÛŒ</div>
      <div id="slidesList">${renderSlidesList(slides)}</div>
      <button class="btn btn-primary" style="margin-top:16px" onclick="openAddSlide()">+ Ø§Ø³Ù„Ø§ÛŒØ¯ Ø¬Ø¯ÛŒØ¯</button>
    </div>
    <div class="panel" id="slideFormPanel" style="display:none">
      <div class="panel-title" id="slideFormTitle">Ø§Ø³Ù„Ø§ÛŒØ¯ Ø¬Ø¯ÛŒØ¯</div>
      <div class="f-grid">
        <div class="f-group f-full">
          <label class="f-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ø³Ù„Ø§ÛŒØ¯ *</label>
          <input class="f-input" id="sTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ø³Ù„Ø§ÛŒØ¯">
        </div>
        <div class="f-group f-full">
          <label class="f-label">ØªÙˆØ¶ÛŒØ­</label>
          <input class="f-input" id="sDesc" placeholder="ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡">
        </div>
        <div class="f-group">
          <label class="f-label">Ù„ÛŒÙ†Ú© ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡</label>
          <input class="f-input" id="sImage" placeholder="https://...">
        </div>
        <div class="f-group">
          <label class="f-label">Ù†Ø´Ø§Ù† (Badge)</label>
          <input class="f-input" id="sBadge" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¬Ø¯ÛŒØ¯ØŒ ÙˆÛŒÚ˜Ù‡">
        </div>
        <div class="f-group">
          <label class="f-label">Ù…ØªÙ† Ø¯Ú©Ù…Ù‡</label>
          <input class="f-input" id="sBtn" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ù‚Ø§Ù„Ù‡">
        </div>
        <div class="f-group">
          <label class="f-label">ID Ù…Ù‚Ø§Ù„Ù‡ (Ù„ÛŒÙ†Ú© Ø¯Ú©Ù…Ù‡)</label>
          <input class="f-input" id="sLink" type="number" placeholder="ID Ù…Ù‚Ø§Ù„Ù‡">
        </div>
      </div>
      <input type="hidden" id="sEditIdx" value="-1">
      <div style="display:flex;gap:10px;margin-top:16px">
        <button class="btn btn-primary" onclick="saveSlide()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø§Ø³Ù„Ø§ÛŒØ¯</button>
        <button class="btn btn-ghost" onclick="document.getElementById('slideFormPanel').style.display='none'">Ø§Ù†ØµØ±Ø§Ù</button>
      </div>
    </div>`
}

function renderSlidesList(slides) {
  if (!slides.length) return `<div style="text-align:center;padding:32px;color:var(--text3)"><div style="font-size:40px;margin-bottom:10px">ğŸ </div><p>Ù‡Ù†ÙˆØ² Ø§Ø³Ù„Ø§ÛŒØ¯ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯</p></div>`
  return slides.map((s, i) => `
    <div class="slide-admin-card">
      <div class="slide-admin-thumb">${s.image ? `<img src="${x(s.image)}" onerror="this.parentElement.textContent='ğŸ–¼'">` : 'ğŸ–¼'}</div>
      <div class="slide-admin-info">
        <div class="slide-admin-title">${x(s.title)}</div>
        <div style="font-size:11px;color:var(--text3)">${s.desc ? x(s.desc).substring(0,50)+'...' : 'Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­'}</div>
      </div>
      <div class="slide-admin-actions">
        <button class="btn btn-warn" style="font-size:12px" onclick="editSlide(${i})">âœ</button>
        <button class="btn btn-danger" style="font-size:12px" onclick="deleteSlide(${i})">ğŸ—‘</button>
      </div>
    </div>`).join('')
}

function openAddSlide() {
  ['sTitle','sDesc','sImage','sBadge','sBtn','sLink'].forEach(id => { const el = document.getElementById(id); if(el) el.value = '' })
  document.getElementById('sEditIdx').value = -1
  document.getElementById('slideFormTitle').textContent = 'Ø§Ø³Ù„Ø§ÛŒØ¯ Ø¬Ø¯ÛŒØ¯'
  document.getElementById('slideFormPanel').style.display = 'block'
  document.getElementById('slideFormPanel').scrollIntoView({ behavior: 'smooth' })
}

function editSlide(i) {
  const s = getSlides()[i]
  if (!s) return
  document.getElementById('sTitle').value = s.title || ''
  document.getElementById('sDesc').value  = s.desc  || ''
  document.getElementById('sImage').value = s.image || ''
  document.getElementById('sBadge').value = s.badge || ''
  document.getElementById('sBtn').value   = s.btn   || ''
  document.getElementById('sLink').value  = s.link  || ''
  document.getElementById('sEditIdx').value = i
  document.getElementById('slideFormTitle').textContent = 'ÙˆÛŒØ±Ø§ÛŒØ´ Ø§Ø³Ù„Ø§ÛŒØ¯'
  document.getElementById('slideFormPanel').style.display = 'block'
  document.getElementById('slideFormPanel').scrollIntoView({ behavior: 'smooth' })
}

function saveSlide() {
  const title = document.getElementById('sTitle').value.trim()
  if (!title) { toast('Ø¹Ù†ÙˆØ§Ù† Ø§Ø³Ù„Ø§ÛŒØ¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª', 'err'); return }
  const slide = {
    title,
    desc:  document.getElementById('sDesc').value.trim(),
    image: document.getElementById('sImage').value.trim(),
    badge: document.getElementById('sBadge').value.trim(),
    btn:   document.getElementById('sBtn').value.trim(),
    link:  document.getElementById('sLink').value.trim()
  }
  const slides = getSlides()
  const idx = parseInt(document.getElementById('sEditIdx').value)
  if (idx >= 0) slides[idx] = slide
  else slides.push(slide)
  saveSlides(slides)
  document.getElementById('slidesList').innerHTML = renderSlidesList(slides)
  document.getElementById('slideFormPanel').style.display = 'none'
  toast('Ø§Ø³Ù„Ø§ÛŒØ¯ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ“', 'ok')
}

function deleteSlide(i) {
  if (!confirm('Ø§ÛŒÙ† Ø§Ø³Ù„Ø§ÛŒØ¯ Ø­Ø°Ù Ø´ÙˆØ¯ØŸ')) return
  const slides = getSlides()
  slides.splice(i, 1)
  saveSlides(slides)
  document.getElementById('slidesList').innerHTML = renderSlidesList(slides)
  toast('Ø§Ø³Ù„Ø§ÛŒØ¯ Ø­Ø°Ù Ø´Ø¯', 'ok')
}

// â”€â”€ SETTINGS ADMIN â”€â”€
function renderSettingsAdmin(c) {
  const s = getSiteSettings()
  c.innerHTML = `
    <div class="panel">
      <div class="panel-title">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„ÛŒ Ø³Ø§ÛŒØª</div>
      <div class="settings-grid">
        <div class="f-group">
          <label class="f-label">Ù†Ø§Ù… Ø³Ø§ÛŒØª</label>
          <input class="f-input" id="setName" value="${x(s.siteName)}" placeholder="Ù†Ø§Ù… Ø³Ø§ÛŒØª">
        </div>
        <div class="f-group">
          <label class="f-label">ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡ Ø³Ø§ÛŒØª</label>
          <input class="f-input" id="setDesc" value="${x(s.siteDesc)}" placeholder="ØªÙˆØ¶ÛŒØ­ Ø²ÛŒØ± Ù„ÙˆÚ¯Ùˆ">
        </div>
        <div class="f-group">
          <label class="f-label">Ø±Ù†Ú¯ Ø§ØµÙ„ÛŒ Ø³Ø§ÛŒØª</label>
          <div class="color-input-wrap">
            <input type="color" id="setColorPicker" value="${s.accentColor}"
              oninput="document.getElementById('setColor').value=this.value">
            <input class="f-input" id="setColor" value="${s.accentColor}" placeholder="#16a34a"
              oninput="document.getElementById('setColorPicker').value=this.value">
          </div>
        </div>
        <div class="f-group">
          <label class="f-label">Ù…ØªÙ† ÙÙˆØªØ±</label>
          <input class="f-input" id="setFooter" value="${x(s.footerText)}" placeholder="Ù…ØªÙ† Ù¾Ø§ÛŒÛŒÙ† Ø³Ø§ÛŒØª">
        </div>
      </div>
      <div style="margin-top:20px;display:flex;gap:10px">
        <button class="btn btn-primary" onclick="saveSiteSettingsAdmin()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
        <button class="btn btn-ghost" onclick="resetSettingsAdmin()">â†© Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶</button>
      </div>
    </div>
    <div class="panel">
      <div class="panel-title">ğŸ—‘ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</div>
      <p style="font-size:13px;color:var(--text2);margin-bottom:16px">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø­Ù„ÛŒ (Ø§Ø³Ù„Ø§ÛŒØ¯Ø±ØŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ØŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª) â€” Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Supabase ØªØºÛŒÛŒØ± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.</p>
      <button class="btn btn-danger" onclick="clearLocalData()">ğŸ—‘ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø­Ù„ÛŒ</button>
    </div>`
}

function saveSiteSettingsAdmin() {
  const s = {
    siteName:    document.getElementById('setName').value.trim()  || 'Ø¯Ø±Ø¢Ù…Ø¯ Ù†Ùˆ',
    siteDesc:    document.getElementById('setDesc').value.trim()  || '',
    accentColor: document.getElementById('setColor').value.trim() || '#16a34a',
    footerText:  document.getElementById('setFooter').value.trim() || ''
  }
  saveSiteSettings(s); applySiteSettings()
  toast('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ“', 'ok')
}

function resetSettingsAdmin() {
  localStorage.removeItem(SETTINGS_KEY); applySiteSettings()
  renderSettingsAdmin(document.getElementById('adminContent'))
  toast('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ú¯Ø´Øª', 'ok')
}

function clearLocalData() {
  if (!confirm('ØªÙ…Ø§Ù… ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø­Ù„ÛŒ Ù¾Ø§Ú© Ø´ÙˆØ¯ØŸ')) return
  ;[SETTINGS_KEY, CAT_KEY, SLIDE_KEY].forEach(k => localStorage.removeItem(k))
  applySiteSettings(); toast('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø­Ù„ÛŒ Ù¾Ø§Ú© Ø´Ø¯', 'ok')
}

// â”€â”€ STATS ADMIN â”€â”€
async function renderStatsAdmin(c) {
  c.innerHTML = spinning(true)
  const { count } = await sb.from('articles').select('*', { count: 'exact', head: true })
  const { data: cats } = await sb.from('articles').select('category').not('category', 'is', null)
  const catCount = new Set((cats || []).map(r => r.category).filter(Boolean)).size
  c.innerHTML = `
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-num">${count || 0}</div><div class="stat-label">ğŸ“„ Ú©Ù„ Ù…Ù‚Ø§Ù„Ø§Øª</div></div>
      <div class="stat-card"><div class="stat-num">${catCount}</div><div class="stat-label">ğŸ· Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</div></div>
      <div class="stat-card"><div class="stat-num">${getSlides().length}</div><div class="stat-label">ğŸ  Ø§Ø³Ù„Ø§ÛŒØ¯Ù‡Ø§</div></div>
    </div>
    <div class="panel">
      <div class="panel-title">ğŸ“‹ Ø¢Ø®Ø±ÛŒÙ† Ù…Ù‚Ø§Ù„Ø§Øª</div>
      <div id="statsList"></div>
    </div>`
  const { data } = await sb.from('articles').select('id,title,created_at,category').order('created_at', { ascending: false }).limit(5)
  document.getElementById('statsList').innerHTML = (data || []).map(a => `
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--border);font-size:13px">
      <span style="font-weight:600">${x(a.title)}</span>
      <span style="color:var(--text3)">${fd(a.created_at)}</span>
    </div>`).join('')
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SEO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateSEO({ title, description, image, url, type = 'article' }) {
  document.getElementById('metaTitle').textContent = title
  document.getElementById('metaDesc').setAttribute('content', description)
  document.getElementById('metaCanonical').setAttribute('href', url || BASE_URL)
  document.getElementById('ogTitle').setAttribute('content', title)
  document.getElementById('ogDesc').setAttribute('content', description)
  document.getElementById('ogImage').setAttribute('content', image || '')
  document.getElementById('ogType').setAttribute('content', type)
}
function resetSEO() {
  const s = getSiteSettings()
  updateSEO({ title: s.siteName + ' | Ù…Ù‚Ø§Ù„Ø§Øª Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯', description: s.siteDesc, type: 'website' })
}
function setArticleSEO(a) {
  updateSEO({
    title: a.title + ' | ' + getSiteSettings().siteName,
    description: a.short_description,
    image: a.image,
    url: BASE_URL + '?article=' + a.id
  })
  document.getElementById('schemaOrg').textContent = JSON.stringify({
    "@context":"https://schema.org","@type":"Article",
    "headline":a.title,"description":a.short_description,
    "image":a.image||"","datePublished":a.created_at,
    "author":{"@type":"Organization","name":getSiteSettings().siteName},
    "inLanguage":"fa"
  })
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEEP LINK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkDeepLink() {
  const id = new URLSearchParams(location.search).get('article')
  if (id && sbReady) { go('detail', id); return true }
  return false
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function x(s='') { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;') }
function stripHtml(s='') { return s.replace(/<[^>]*>/g,' ').replace(/\s+/g,' ').trim() }
function fd(iso) { try { return new Date(iso).toLocaleDateString('fa-IR') } catch { return '' } }
function ytEmbed(url) {
  if (!url) return null
  if (url.includes('youtube.com/embed/')) return url
  const m = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/)
  return m ? 'https://www.youtube.com/embed/' + m[1] : null
}
function showAlert(el, msg) { if(el){el.textContent = msg; el.style.display = 'block'} }
function hide(el) { if (el) el.style.display = 'none' }
function toast(msg, type = '') {
  const el = document.getElementById('toast')
  el.textContent = msg; el.className = 'toast ' + type + ' show'
  clearTimeout(el._t); el._t = setTimeout(() => el.classList.remove('show'), 3200)
}
function spinning(full = false) {
  return `<div style="text-align:center;padding:${full?'80':'40'}px 20px;color:var(--text3);grid-column:1/-1">
    <div style="font-size:32px;margin-bottom:10px">â³</div><p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p></div>`
}
function errHtml(msg) {
  return `<div class="empty"><div class="empty-icon">âš ï¸</div><h3>Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„</h3><p style="font-size:12px;color:var(--red);margin-top:6px">${x(msg)}</p></div>`
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCROLL HEADER SHADOW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('scroll', () => {
  document.getElementById('hdr').classList.toggle('scrolled', window.scrollY > 10)
})

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  START
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
applySiteSettings()
if (!checkDeepLink()) loadArticles()
loadSlider()
</script>
</body>
</html>
